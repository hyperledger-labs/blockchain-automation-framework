{
    "title": "Network Document",
    "description": "Document",
    "type": "object",
    "properties": {
        "network": {
          "description": "Network description",
          "type": "object",
          "properties": {
              "type": { "type": "string", "enum": ["fabric","corda", "corda-enterprise", "indy"],"description": "Network type"},
              "env": { "$ref":"#/definitions/shared_environment"},
              "docker": { "$ref":"#/definitions/shared_docker"}
          },
          "allOf":[
            {"if": {"properties": { "type": { "const": "corda" } } },
             "then": {
              "properties":{
                "version":{ "type": "number","enum":[4.4,4.7]},
                "frontend": { "type": "string", "enum": ["enabled","disabled"]},
                "network_services": { "type":"array","items":{ "$ref":"#/definitions/corda_network_service"}},
                "organizations": { "type":"array","minItems": 1,"items":{"$ref":"#/definitions/corda_organization"}}      
               }
             }
            }               
          ],
          "required": [ "type","version","env","docker","organizations" ]
          
        }
    },
    "required": [ "network" ] ,

    "definitions": { 
        "shared_environment":{
            "type": "object",
            "properties": {
              "type": { "type": "string","pattern": "^[A-Za-z0-9-]{1,10}$"},
              "proxy": { "type": "string", "enum": ["haproxy", "ambassador"]},           
              "retry_count": {"type": "integer", "minimum":5,"maximum":100}, 
              "external_dns": { "type": "string", "enum": ["enabled", "disabled"]}
              },
            "required": [ "type","proxy","external_dns","retry_count" ]
        },             
        "shared_docker":{
            "type": "object",
            "properties": {
              "url": { "type": "string","pattern": "^(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\\.)+[a-z0-9][a-z0-9-]{0,61}[a-z0-9](?:\\:[0-9]{2,5})?(?:\/[a-z0-9-]{1,61})*$"},
              "username": { "type": "string","pattern":"^[a-zA-Z0-9._]+$"},
              "password": {"type": "string"}
             },
            "required": [ "url","username","password"]
        },                                 
        "shared_k8s":{
          "type": "object",
          "properties": {
            "provider": { "type": "string","enum": ["aws", "azure","gcp","minikube"]},
            "region": { "type": "string"},
            "context":{ "type": "string"},
            "config_file":{ "type": "string"}
           },
          "required": [ "context","config_file"],
          "additionalProperties": false
        },
        "shared_aws":{
          "type": "object",
          "properties": {
            "access_key": { "type": "string","pattern": "^[A-Za-z0-9]{20}$"},
            "secret_key": { "type": "string","pattern": "^[A-Za-z0-9/]{40}$"},
            "region": { "type": "string"},
            "zone":{ "type": "string"}
           },
          "required": [ "access_key","secret_key"],
          "additionalProperties": false
        },        
        "shared_vault":{
          "type": "object",
          "properties": {
            "url": { "type": "string"},
            "root_token": { "type": "string","pattern": "^s.[a-zA-Z0-9]{24}$"},
            "secret_path": { "type": "string"}
           },
          "required": [ "url","root_token"],
          "additionalProperties": false
        },  
        "shared_gitops":{
          "type": "object",
          "properties": {
            "git_protocol": { "type": "string","enum": ["https", "ssh"]},
            "git_url": { "type": "string"}, 
            "branch": { "type": "string"}, 
            "release_dir": { "type": "string"}, 
            "chart_source":{ "type": "string"}, 
            "git_repo": { "type": "string"}, 
            "username": { "type": "string"}, 
            "password": { "type": "string"}, 
            "private_key": { "type": "string"},  
            "email": { "type": "string"}                
           },
          "required": [ "git_protocol","git_url","branch","release_dir","chart_source","git_repo","username","password","private_key","email"],
          "additionalProperties": false
        }, 
        "corda_network_service":{
          "type": "object",
          "properties": {
            "type": { "type": "string", "enum": ["doorman", "networkmap"]},   
            "uri": { "type": "string"},
            "certificate": { "type": "string"}
           },
          "required": [ "type","uri","certificate"]
        },         
        "corda_organization":{
          "type": "object",
          "properties": {
            "k8s":{ "$ref":"#/definitions/shared_k8s"},
            "vault":{ "$ref":"#/definitions/shared_vault"},
            "gitops":{ "$ref":"#/definitions/shared_gitops"},
            "aws":{ "$ref":"#/definitions/shared_aws"},
            "name": { "type": "string","pattern": "^[A-Za-z0-9-]{1,30}$"},
            "type": { "type": "string","pattern": "^[A-Za-z0-9-]{1,30}$"},
            "country": { "type": "string"},
            "state": { "type": "string"},
            "location": { "type": "string"}, 
            "subject":  { "type": "string"},    
            "external_url_suffix":  { "type": "string"},
            "services":{ "$ref":"#/definitions/corda_node_service"}
            },
          "required": [ "name","type","country","state","location","subject","external_url_suffix","services"]
        },  
        "corda_node_service":{
          "type": "object",
          "properties": {
            "doorman": { "$ref":"#/definitions/corda_service_doorman_nms"},
            "nms": { "$ref":"#/definitions/corda_service_doorman_nms"},
            "notary": { "$ref":"#/definitions/corda_service_notary"},
            "peers": {  "type":"array","items":{ "$ref":"#/definitions/corda_service_peer"}}
            }
        },  
        "corda_service_doorman_nms":{
          "type": "object",
          "properties": {
            "name": { "type": "string"},
            "subject": { "type": "string"},
            "db_subject": { "type": "string"},
            "type":{ "type": "string","enum": ["doorman","networkmap"]},
            "tls": { "type": "string","enum": ["on","off"]},       
            "ports":{ "$ref":"#/definitions/corda_service_port_doorman"}
            }
        },
        "corda_service_notary":{
          "type": "object",
          "properties": {
            "name": { "type": "string"},
            "subject": { "type": "string"},
            "db_subject": { "type": "string"},
            "type":{ "type": "string","enum": ["notary"]},
            "tls": { "type": "string","enum": ["on","off"]},       
            "p2p":{ "$ref":"#/definitions/corda_service_port_ambassador"},
            "rpc":{ "$ref":"#/definitions/corda_service_port"},
            "p2padmin":{ "$ref":"#/definitions/corda_service_port"},
            "dbtcp":{ "$ref":"#/definitions/corda_service_port"},
            "dbweb":{ "$ref":"#/definitions/corda_service_port"}                                          
            }
        },  
        "corda_service_peer":{
          "type": "object",
          "properties": {
            "name": { "type": "string"},
            "subject": { "type": "string"},
            "db_subject": { "type": "string"},
            "type":{ "type": "string","enum": ["node"]},
            "tls": { "type": "string","enum": ["on","off"]},       
            "p2p":{ "$ref":"#/definitions/corda_service_port_ambassador"},
            "rpc":{ "$ref":"#/definitions/corda_service_port"},
            "p2padmin":{ "$ref":"#/definitions/corda_service_port"},
            "dbtcp":{ "$ref":"#/definitions/corda_service_port"},
            "dbweb":{ "$ref":"#/definitions/corda_service_port"},
            "springboot":{ "$ref":"#/definitions/corda_service_port"},
            "expressapi":{ "$ref":"#/definitions/corda_service_port"}                                                                    
            }
        },  
        "corda_service_port_doorman":{
          "type": "object",
          "properties": {
            "servicePort": { "type": "number"},
            "targetPort": { "type": "number"}
            },
          "required": [ "servicePort","targetPort"],
          "additionalProperties": false
        },               
        "corda_service_port":{
          "type": "object",
          "properties": {
            "port": { "type": "number"},
            "targetPort": { "type": "number"}
            },
          "required": [ "port","targetPort"],
          "additionalProperties": false
        }, 
        "corda_service_port_ambassador":{
          "type": "object",
          "properties": {
            "port": { "type": "number"},
            "targetPort": { "type": "number"},
            "ambassador": { "type": "number"}
            },
          "required": [ "port","targetPort","ambassador"],
          "additionalProperties": false
        }                           
    }  
  }
